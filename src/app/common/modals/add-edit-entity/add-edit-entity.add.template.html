<div class="modal-content add-edit-entity">
    <div class="modal-header">
        <button type="button" class="close" ng-click="$ctrl.cancel()" aria-hidden="true">Ã—</button>
        <h4 class="modal-title">Add new</h4>
    </div>
    <div class="modal-body">
        <form name="$ctrl.entityForm" class="form-horizontal">
            <fieldset>
                <div class="form-group">
                    <label for="connection" class="col-lg-2 control-label">Connection</label>
                    <div class="col-lg-10">
                        <ui-select name="connection" id="connection" ng-model="$ctrl.input.connection" theme="bootstrap" ng-disabled="!$ctrl.connections" on-select="$ctrl.selectedConnection($item, $model)" reset-search-input="false">
                            <ui-select-match placeholder="Select or add connection">
                                <v ng-bind-html="$select.selected.name || $select.search"></v>
                                <i class="ui-remove btn btn-xs btn-link pull-right glyphicon glyphicon-remove" ng-click="$ctrl.clearSelection($event, $select)"></i>
                            </ui-select-match>
                            <ui-select-choices repeat="item in $ctrl.connections | filter: $select.search" refresh="$ctrl.refreshResults($select)" refresh-delay="0">
                                <div ng-bind-html="item.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
                <span class="animate-show" ng-show="$ctrl.input.connection && $ctrl.subConnections">
                    <fieldset  ng-if="$ctrl.subConnections.length > 0">
                        <legend >Select Autogenerated Info 
                            <i class="glyphicon pull-right" 
                                ng-class="{'glyphicon-chevron-up': $ctrl.inputType.auto, 'glyphicon-chevron-down': !$ctrl.inputType.auto}"
                                ng-click="$ctrl.inputType.auto = !$ctrl.inputType.auto"></i>
                        </legend >
                            <span class="autogenerated animate-show" ng-show="$ctrl.inputType.auto">
                                <div class="form-group">
                                    <label for="subconnection" class="col-lg-2 control-label">Entity&nbsp;Name</label>
                                    <div class="col-lg-10">
                                        <ui-select name="subconnection" id="subconnection" ng-model="$ctrl.input.subconnection" theme="bootstrap" on-select="$ctrl.selectedSubConnection($item, $model)" reset-search-input="false">
                                            <ui-select-match placeholder="Select Entity">
                                                <v ng-bind-html="$select.selected.name || $select.search"></v>
                                                <i class="ui-remove btn btn-xs btn-link pull-right glyphicon glyphicon-remove" ng-click="$ctrl.clearSelection($event, $select)"></i>
                                            </ui-select-match>
                                            <ui-select-choices repeat="item in $ctrl.subConnections | filter: $select.search" refresh="$ctrl.refreshResults($select)" refresh-delay="0">
                                                <div ng-bind-html="item.name | highlight: $select.search"></div>
                                            </ui-select-choices>
                                        </ui-select>
                                    </div>
                                </div>
                            </span>
                    </fieldset>
                    <fieldset >
                        <legend >Manual input
                            <i class="glyphicon pull-right" 
                                ng-class="{'glyphicon-chevron-down': $ctrl.inputType.manual, 'glyphicon-chevron-up': !$ctrl.inputType.manual}"
                                ng-click="$ctrl.inputType.manual = !$ctrl.inputType.manual"></i>
                        </legend>
                            <span class="manual animate-show" ng-show="$ctrl.inputType.manual">
                                <div class="form-group" form-group-validation>
                                    <label for="name" class="col-lg-2 control-label">Name</label>
                                    <div class="col-lg-10">
                                        <input type="text" name="name" placeholder="Name" class="form-control" id="name" ng-model="$ctrl.input.value.name" ng-disabled="$ctrl.input.subconnection" ng-required="!$ctrl.input.subconnection">
                                    </div>
                                </div>
                                <div class="form-group" form-group-validation>
                                    <label for="description" class="col-lg-2 control-label">Description</label>
                                    <div class="col-lg-10">
                                        <input type="text" name="description" placeholder="Description" class="form-control" id="description" ng-model="$ctrl.input.value.description" ng-disabled="$ctrl.input.subconnection" ng-required="!$ctrl.input.subconnection">
                                    </div>
                                </div>
                            </span>
                    </fieldset>
                </span>
            </fieldset>
            <fieldset>
                <legend >Attachments
                    <i class="glyphicon pull-right" 
                        ng-class="{'glyphicon-chevron-down': $ctrl.inputType.attachments, 'glyphicon-chevron-up': !$ctrl.inputType.attachments}"
                        ng-click="$ctrl.inputType.attachments = !$ctrl.inputType.attachments"></i>
                </legend>
                <div class="animate-show" ng-show="$ctrl.inputType.attachments">
                    <media-file-view 
                        on-change="$ctrl.filesChanged(files, b64)" 
                        files="$ctrl.input.value.files">
                    </media-file-view>
                </div>
            </fieldset>
        </form>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-default" ng-click="$ctrl.cancel()">Cancel</button>
        <button type="button" class="btn btn-primary" ng-click="$ctrl.add()">Add</button>
    </div>
</div>
